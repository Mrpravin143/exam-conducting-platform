<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Question</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; margin:0; padding:0; }

    .info-box {
        position: fixed;
        top: 20px; right: 20px;
        width: 220px;
        background: #ffc107; color: #000;
        padding: 15px 20px; border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        text-align: center; font-weight: bold;
    }

    .timer {
        position: fixed; top: 20px; left: 20px;
        font-size: 18px; font-weight: bold; color: red;
        background: #fff3cd; padding: 10px 15px;
        border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .question-container {
        display: flex; justify-content: center; align-items: flex-start;
        min-height: 100vh; padding-top: 120px; text-align: center;
    }

    .question-text { font-size: 28px; font-weight: 500; margin-bottom: 30px; line-height: 1.4; }
    .options { display: inline-block; text-align: left; margin-top: 20px; }
    .form-check { margin-bottom: 15px; }
    .btn-container { margin-top: 30px; display: flex; justify-content: space-between; max-width: 400px; margin-left:auto; margin-right:auto; }

    @media(max-width:768px){
        .info-box { width: 180px; padding: 10px 15px; }
        .question-text { font-size: 22px; }
    }
</style>
</head>
<body>

<div class="info-box">
    <p>Unique ID: {{ session.unique_id }}</p>
    <p>User: {{ session.student.username }}</p>
</div>

<div class="timer" id="timer">Time Left:</div>

<div class="question-container">
    <form method="post">
        {% csrf_token %}

        <div class="question-text">
            Question {{ q_no }} of {{ total_qs }}:<br>{{ question.text }}
        </div>

        {% if question.question_type == "MCQ" %}
        <div class="options">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="selected_option" value="{{ question.option1 }}" id="opt1">
                <label class="form-check-label" for="opt1">{{ question.option1 }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="selected_option" value="{{ question.option2 }}" id="opt2">
                <label class="form-check-label" for="opt2">{{ question.option2 }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="selected_option" value="{{ question.option3 }}" id="opt3">
                <label class="form-check-label" for="opt3">{{ question.option3 }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="selected_option" value="{{ question.option4 }}" id="opt4">
                <label class="form-check-label" for="opt4">{{ question.option4 }}</label>
            </div>
        </div>
        {% else %}
        <textarea class="form-control" name="answer_text" rows="4" placeholder="Type your answer here" style="width:400px;margin:auto;display:block;"></textarea>
        {% endif %}

        <div class="btn-container">
            {% if q_no > 1 %}
                <a href="{% url 'exam_question' session.id q_no|add:'-1' %}" class="btn btn-secondary">Previous</a>
            {% else %}<span></span>{% endif %}
            <button type="submit" class="btn btn-primary">Next</button>
        </div>

    </form>
</div>

<script>
var timeLeft = {{ remaining_seconds }};
var timer = document.getElementById("timer");

var countdown = setInterval(function(){
    if(timeLeft <= 0){
        clearInterval(countdown);
        // Auto-submit redirect
        window.location.href = "{% url 'exam_finish' session.id %}";
        return;
    }
    var hours = Math.floor(timeLeft / 3600);
    var minutes = Math.floor((timeLeft % 3600)/60);
    var seconds = timeLeft % 60;
    timer.innerHTML = "Time Left: " + (hours>0? hours+"h ":"") + minutes + "m " + seconds + "s";
    timeLeft -= 1;
}, 1000);
</script>

</body>
</html>
